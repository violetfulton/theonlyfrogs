<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>{{ title or "Pok√©mon Shrine" }}</title>
  <link rel="stylesheet" href="/assets/css/pokemon.css">
  <link href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap" rel="stylesheet">
</head>
<body>

  {{ content | safe }}

  <!-- üê∏ Pok√©dex Menu -->
  <div class="pokemap-wrapper">
  <button class="pokemap-toggle">Open Pok√©dex ‚ñº</button>

  <div class="pokemap-container">
    <img
      src="/assets/imgs/graphics/menu.bmp"
      usemap="#image-map"
      class="pokemap-image"
      alt="Pok√©mon Menu"
    >

    <map name="image-map">
      <area target="_self" alt="Pokemon Shrine" title="Pokemon Shrine" href="/shrines/pokemon" coords="9,43,154,77" shape="rect">
      <area target="_self" alt="My Pokemon Collection" title="My Pokemon Collection" href="/shrines/pokemon/physical" coords="10,103,150,137" shape="rect">
      <area target="_self" alt="My Pokemon Home" title="My Pokemon Home" href="/shrines/pokemon/collection" coords="169,42,312,76" shape="rect">
      <area target="_self" alt="About the Trainer" title="About the Trainer" href="/shrines/pokemon/me" coords="168,102,313,139" shape="rect">
      <area target="_self" alt="Hall of Fame" title="Hall of Fame" href="/shrines/pokemon/hof" coords="9,163,151,198" shape="rect">
      <area target="_self" alt="Go Home!" title="Go Home!" href="/" coords="167,161,314,198" shape="rect">
    </map>
  </div>
</div>

<!-- JS Dependencies -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="/assets/js/jquery.style-my-tooltips.js"></script>
<script src="https://cdn.jsdelivr.net/npm/image-map-resizer@1.0.10/js/imageMapResizer.min.js"></script>

<script>
$(function(){

  /* === Tooltips === */
  if ($.fn.style_my_tooltips) {
    $("area[title]").style_my_tooltips({
      tip_follows_cursor: true,
      tip_delay_time: 80,
      tip_fade_speed: 200
    });
  }

  /* === Responsive Image Map === */
  if (typeof imageMapResize === 'function') {
    $('map').imageMapResize();
  }

  /* === Pok√©dex Open/Close === */
  const $toggle = $('.pokemap-toggle');
  const $container = $('.pokemap-container');
  const $wrapper = $('.pokemap-wrapper');

  function togglePokedex(forceState) {
    const isOpen = forceState !== undefined ? forceState : !$container.hasClass('open');
    $container.toggleClass('open', isOpen);
    $wrapper.toggleClass('open', isOpen);
    $toggle.text(isOpen ? 'Close Pok√©dex ‚ñ≤' : 'Open Pok√©dex ‚ñº');
  }

  $toggle.on('click', function(e){
    e.stopPropagation();
    togglePokedex();
  });

  $(document).on('click', function(e){
    if ($container.hasClass('open')) {
      const clickedInside = $(e.target).closest('.pokemap-wrapper').length > 0;
      if (!clickedInside) togglePokedex(false);
    }
  });

  $(document).on('keydown', function(e){
    if (e.key === 'Escape' && $container.hasClass('open')) {
      togglePokedex(false);
    }
  });

});
</script>
</body>
</html>